<mat-tree *ngIf="gherkinData" [dataSource]="nestedDataSource" [treeControl]="nestedTreeControl"
          class="documentation-tree">

  <mat-nested-tree-node *matTreeNodeDef="let node; when: hasNestedChild">

    <li id="{{node.nodeId}}">

      <div *ngIf="node.type == 'project'" class="mat-tree-node project">
        <button mat-icon-button matTreeNodeToggle [attr.aria-label]="'toggle ' + node.data.name">
          <mat-icon class="mat-icon-rtl-mirror">
            {{ nestedTreeControl.isExpanded(node) ? 'expand_more' : 'chevron_right' }}
          </mat-icon>
        </button>
        {{ node.data.name }}  <span *ngIf="node.branch" class="branch">({{ node.branch.data.name }})</span>

      </div>

      <app-gherkin-feature *ngIf="node.type == 'feature'" [currentNode]="node" [url]="url"
                           [nestedTreeControl]="nestedTreeControl"></app-gherkin-feature>

      <app-gherkin-background *ngIf="node.type == 'background'" [steps]="node.steps"></app-gherkin-background>


      <div *ngIf="node.type == 'scenario'" class="mat-tree-node scenario">
        <button mat-icon-button matTreeNodeToggle [attr.aria-label]="'toggle ' + node.data.name">
          <mat-icon class="mat-icon-rtl-mirror">
            {{ nestedTreeControl.isExpanded(node) ? 'expand_more' : 'chevron_right' }}
          </mat-icon>
        </button>
        <span class="scenario">{{ node.data.name }}  </span>
        <a (click)="defineHash(node.nodeId)" class="bookLink">
    <li class="fas fa-link fa-sm"></li>
    </a>
    </div>


    <div *ngIf="node.type == 'scenario'" [class.documentation-tree-invisible]="!nestedTreeControl.isExpanded(node)">

      <div class="mat-tree-node ">
        <ul class="flex-container flex-direction-column flex-align-items-start">
          <li>

            <div>
              <ul class="flex-container flex-direction-row flex-align-items-start">
                <li *ngIf="node.data.abstractionLevel.startsWith('level_0')" class="tag fas fa-graduation-cap fa-sm "
                    title="High level of abstraction"></li>
                <li *ngIf="node.data.abstractionLevel.startsWith('level_2')" class="tag fas fa-cogs fa-sm "
                    title="Technical details"></li>
                <li *ngIf="node.data.caseType.startsWith('error')" class="tag fas fa-times-circle fa-sm "
                    title="Error case"></li>
                <li *ngIf="node.data.caseType.startsWith('limit')" class="tag fas fa-exclamation-triangle fa-sm "
                    title="Limit case"></li>
                <li class="steps">
                  <div *ngFor="let step of node.steps">
                    <ul class="flex-container flex-direction-column flex-align-items-start">
                      <li>
                        <app-gherkin-step [step]="step"></app-gherkin-step>
                      </li>
                    </ul>
                  </div>
                </li>
              </ul>
            </div>
          </li>
        </ul>
      </div>


    </div>


    <div *ngIf="node.type == 'scenario'  && node.examples"
         [class.documentation-tree-invisible]="!nestedTreeControl.isExpanded(node)">
      <li>
        <div class="step">
          <span class="stepKeyword">Examples</span>&nbsp;
        </div>
      </li>
      <div class="table pull-right">
        <app-gherkin-table [table]="node.examples.table"></app-gherkin-table>
      </div>
    </div>


    <ul [class.documentation-tree-invisible]="!nestedTreeControl.isExpanded(node)">
      <ng-container matTreeNodeOutlet></ng-container>
    </ul>


    </li>
  </mat-nested-tree-node>
</mat-tree>
