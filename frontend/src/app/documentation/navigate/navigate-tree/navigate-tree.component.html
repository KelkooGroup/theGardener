<div [hidden]="loading" >
  <div *ngIf="nodes">
    <mat-expansion-panel *ngFor="let node of nodes;"
                         (opened)="setSelectedNode(node)" multi >
      <mat-expansion-panel-header>
        <mat-panel-title>
          <div class="node level{{level}}">
            {{node.name}}
          </div>
        </mat-panel-title>
      </mat-expansion-panel-header>

      <div *ngIf="node.children.length > 0 || node.projects.length > 0">
        <app-navigate-tree [level]="level + 1" [nodes]="node.children" [projects]="node.projects" [parentPath]="node.path"
                           (selection)="selectionFromChild($event)"></app-navigate-tree>
      </div>
    </mat-expansion-panel>
  </div>

  <div *ngIf="projects">
    <mat-expansion-panel *ngFor="let project of projects;"
                         (opened)="setSelectedProject(project)" multi >
      <mat-expansion-panel-header>
        <mat-panel-title>
          <div class="project level{{level}}">
            {{project.label}}
          </div>
        </mat-panel-title>
      </mat-expansion-panel-header>

      <div class="branch level{{level}}">
        <mat-select class="branches" placeholder="Stable branch by default"
                    (selectionChange)="setSelectedBranch($event.source.value)">
          <mat-option [class.stable-branch]="branch.name == project.stableBranch.name"
                      *ngFor="let branch of project.branches" [value]="branch">{{branch.name}}
          </mat-option>
        </mat-select>
      </div>
      <div
        *ngIf="selectedBranch && (  selectedBranch.rootDirectory.features.length > 0  || selectedBranch.rootDirectory.directories.length > 0 ) ">
        <app-navigate-tree [level]="level + 1" [features]="selectedBranch.rootDirectory.features"
                           [directories]="selectedBranch.rootDirectory.directories"
                           (selection)="selectionFromChild($event)"  [parentPath]="project.path()" ></app-navigate-tree>
      </div>
    </mat-expansion-panel>
  </div>

  <div *ngIf="directories">
    <mat-expansion-panel *ngFor="let directory of directories;"
                         (opened)="setSelectedDirectory(directory)" multi >
      <mat-expansion-panel-header>
        <mat-panel-title>
          <div class="project level{{level}}">
            {{directory.name}}
          </div>
        </mat-panel-title>
      </mat-expansion-panel-header>
      <div *ngIf="directory.features.length > 0  || directory.directories.length > 0  ">
        <app-navigate-tree [level]="level + 1" [features]="directory.features" [directories]="directory.directories"
                           (selection)="selectionFromChild($event)"  [parentPath]="directory.path()" ></app-navigate-tree>
      </div>
    </mat-expansion-panel>
  </div>

  <div *ngIf="features">
    <mat-expansion-panel *ngFor="let feature of features;"
                         (opened)="setSelectedFeature(feature)" multi hideToggle>
      <mat-expansion-panel-header>
        <mat-panel-title>
          <div class="feature level{{level}}">
            {{feature.display}}
          </div>
        </mat-panel-title>
      </mat-expansion-panel-header>
    </mat-expansion-panel>
  </div>
</div>
