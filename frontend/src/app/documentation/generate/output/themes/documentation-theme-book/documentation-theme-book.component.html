<mat-tree [dataSource]="nestedDataSource" [treeControl]="nestedTreeControl" class="documentation-tree">

  <mat-nested-tree-node *matTreeNodeDef="let node; when: hasNestedChild">
    <li   id="{{node.nodeId}}">

      <div  *ngIf="node.type == 'node'" class="mat-tree-node"   >
        <button mat-icon-button matTreeNodeToggle
                [attr.aria-label]="'toggle ' + node.data.name">
          <mat-icon class="mat-icon-rtl-mirror">
            {{nestedTreeControl.isExpanded(node) ? 'expand_more' : 'chevron_right'}}
          </mat-icon>
        </button>
        <a  class="bookLink" href="{{url}}#{{node.nodeId}}"    >~</a>
        <div  class="documentationNode level{{node.level}}" >{{node.data.name}}</div>
      </div>

      <div  *ngIf="node.type == 'project'" class="mat-tree-node" >
        <button mat-icon-button matTreeNodeToggle [attr.aria-label]="'toggle ' + node.data.name">
          <mat-icon class="mat-icon-rtl-mirror">
            {{nestedTreeControl.isExpanded(node) ? 'expand_more' : 'chevron_right'}}
          </mat-icon>
        </button>
        <a  class="bookLink" href="{{url}}#{{node.nodeId}}"    >~</a>
        {{node.data.name}}  <span class="branch" >({{node.branch.data.name}})</span>
      </div>

      <div  *ngIf="node.type == 'feature'" class="mat-tree-node" >
        <button mat-icon-button matTreeNodeToggle [attr.aria-label]="'toggle ' + node.data.name">
          <mat-icon class="mat-icon-rtl-mirror">
            {{nestedTreeControl.isExpanded(node) ? 'expand_more' : 'chevron_right'}}
          </mat-icon>
        </button>
        <a  class="bookLink" href="{{url}}#{{node.nodeId}}"    >~</a>
        <ul class="flex-container flex-direction-column flex-align-items-start" >
          <li>
              <span class="feature level{{node.level}}" >{{node.data.name}}</span>
          </li>
          <li>
              <span class="feature" >{{node.data.description}}  </span>
          </li>
        </ul>
      </div>

      <div  *ngIf="node.type == 'scenario'" class="mat-tree-node">
        <button mat-icon-button matTreeNodeToggle [attr.aria-label]="'toggle ' + node.data.name">
          <mat-icon class="mat-icon-rtl-mirror">
            {{nestedTreeControl.isExpanded(node) ? 'expand_more' : 'chevron_right'}}
          </mat-icon>
        </button>
        <a  class="bookLink" href="{{url}}#{{node.nodeId}}"    >~</a>
        <span class="scenario" >{{node.data.name}}  </span>
      </div>


      <div *ngIf="node.type == 'scenario'"   [class.documentation-tree-invisible]="!nestedTreeControl.isExpanded(node)">

        <div class="mat-tree-node pull-right" >
          <ul class="flex-container flex-direction-column flex-align-items-start" >
            <li>

              <div class="pull-right" >
                <ul class="flex-container flex-direction-column flex-align-items-start" >
                  <li>
                    <ul>
                      <li class="tags" >{{node.data.abstractionLevel}}
                          {{node.data.caseType}}
                          {{node.data.workflowStep}}</li>
                      <div class="steps">
                        <div class="pull-right" *ngFor="let step of node.steps">
                          <ul class="flex-container flex-direction-column flex-align-items-start" >
                            <li>
                              <div class="step" >
                                <span class="stepKeyword" >{{step.data.keyword}}</span>&nbsp;
                                <span [class.stepParameter]="fragment.isParameter"  [class.stepText]="! fragment.isParameter"  *ngFor="let fragment of step.text">{{fragment.text}}</span>
                              </div>
                              <div  *ngIf="step.hasTable"  class="table pull-right" >
                                <app-documentation-theme-book-table [table]="step.table" ></app-documentation-theme-book-table>
                              </div>


                            </li>
                          </ul>
                        </div>
                      </div>
                    </ul>
                  </li>
                </ul>
              </div>

            </li>
          </ul>
        </div>



      </div>




      <ul [class.documentation-tree-invisible]="!nestedTreeControl.isExpanded(node)">
        <ng-container matTreeNodeOutlet></ng-container>
      </ul>


    </li>
  </mat-nested-tree-node>
</mat-tree>
