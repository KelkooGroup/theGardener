<% require 'kelkoo/erb_utils' %><configuration>

    <appender name="FILE" class="ch.qos.logback.core.FileAppender">
        <file><%= value("application_logs") %>/<%= value("the_gardener_log_file") %></file>
        <% if (value("the_gardener_enable_json_log_format") == 'true') %>
        <encoder class="net.logstash.logback.encoder.LogstashEncoder">
            <fieldNames>
                <timestamp>log_timestamp</timestamp>
            </fieldNames>
            <timeZone>UTC</timeZone>
        </encoder>
        <% else %>
        <encoder>
            <pattern>%date - [%level] - from %logger in %thread %class.%M:%L %message%n%xException%n</pattern>
        </encoder>
        <% end %>
    </appender>

    <appender name="ACCESS_LOG_FILE" class="ch.qos.logback.core.FileAppender">
      <file><%= value("application_logs") %>/<%= value("the_gardener_access_log_file") %></file>
      <encoder>
         <pattern>%message%n</pattern>
      </encoder>
    </appender>

    <!-- Warning ASYNCFILE is more performant but can result in (non error) messages loss https://logback.qos.ch/manual/appenders.html#AsyncAppender-->
    <appender name="ASYNCFILE" class="ch.qos.logback.classic.AsyncAppender">
        <appender-ref ref="FILE" />
    </appender>

    <logger name="play" level="<%= value("the_gardener_play_log_level") %>" />
    <logger name="application" level="<%= value("the_gardener_kelkoo_log_level") %>" />
    <logger name="accesslog" level="INFO" additivity="false">
      <appender-ref ref="ACCESS_LOG_FILE"/>
    </logger>

    <!-- Off these ones as they are annoying, and anyway we manage configuration ourself -->
    <logger name="com.avaje.ebean.config.PropertyMapLoader" level="OFF" />
    <logger name="com.avaje.ebeaninternal.server.core.XmlConfigLoader" level="OFF" />
    <logger name="com.avaje.ebeaninternal.server.lib.BackgroundThread" level="OFF" />
    <logger name="com.gargoylesoftware.htmlunit.javascript" level="OFF" />

    <root level="<%= value("the_gardener_all_log_level") %>">
        <appender-ref ref="ASYNCFILE" />
    </root>

</configuration>
